**Schema (MySQL v5.7)**

    CREATE TABLE customers (
        customer_id INT PRIMARY KEY,
        name VARCHAR(50),
        city VARCHAR(50),
        join_date DATE
    );
    
    INSERT INTO customers VALUES
    (1, 'Asha', 'Chennai', '2020-01-15'),
    (2, 'Ravi', 'Mumbai', '2019-11-10'),
    (3, 'Meena', 'Delhi', '2021-06-20'),
    (4, 'Kiran', 'Bangalore', '2020-08-05'),
    (5, 'Divya', 'Hyderabad', '2022-03-14');
    
    CREATE TABLE accounts (
        account_id INT PRIMARY KEY,
        customer_id INT,
        account_type VARCHAR(20),
        balance INT,
        FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
    );
    
    INSERT INTO accounts VALUES
    (101, 1, 'Savings', 45000),
    (102, 1, 'Current', 20000),
    (103, 2, 'Savings', 90000),
    (104, 3, 'Savings', 30000),
    (105, 4, 'Current', 75000),
    (106, 5, 'Savings', 15000);
    
    CREATE TABLE transactions (
        txn_id INT PRIMARY KEY,
        account_id INT,
        txn_date DATE,
        txn_type VARCHAR(20),
        amount INT,
        FOREIGN KEY (account_id) REFERENCES accounts(account_id)
    );
    
    INSERT INTO transactions VALUES
    (1, 101, '2023-01-10', 'Debit', 5000),
    (2, 101, '2023-01-25', 'Credit', 12000),
    (3, 102, '2023-02-05', 'Debit', 3000),
    (4, 103, '2023-02-15', 'Debit', 15000),
    (5, 103, '2023-03-10', 'Debit', 20000),
    (6, 104, '2023-03-22', 'Credit', 10000),
    (7, 105, '2023-04-01', 'Debit', 25000),
    (8, 105, '2023-04-15', 'Credit', 18000),
    (9, 106, '2023-05-10', 'Debit', 5000);
    

---

**Query #1**

    SELECT c.name, c.city, a.account_type, a.balance 
    FROM customers c
    JOIN accounts a ON c.customer_id = a.customer_id;

| name  | city      | account_type | balance |
| ----- | --------- | ------------ | ------- |
| Asha  | Chennai   | Savings      | 45000   |
| Asha  | Chennai   | Current      | 20000   |
| Ravi  | Mumbai    | Savings      | 90000   |
| Meena | Delhi     | Savings      | 30000   |
| Kiran | Bangalore | Current      | 75000   |
| Divya | Hyderabad | Savings      | 15000   |

---
**Query #2**

    
    
    SELECT 
        account_id,
        SUM(amount) AS total_amount,
        AVG(amount) AS average_amount
    FROM transactions
    GROUP BY account_id;

| account_id | total_amount | average_amount |
| ---------- | ------------ | -------------- |
| 101        | 17000        | 8500.0000      |
| 102        | 3000         | 3000.0000      |
| 103        | 35000        | 17500.0000     |
| 104        | 10000        | 10000.0000     |
| 105        | 43000        | 21500.0000     |
| 106        | 5000         | 5000.0000      |

---
**Query #3**

    
    
    SELECT 
        c.name,
        SUM(a.balance) AS total_balance
    FROM customers c
    JOIN accounts a ON c.customer_id = a.customer_id
    GROUP BY c.name
    ORDER BY total_balance DESC
    LIMIT 3;

| name  | total_balance |
| ----- | ------------- |
| Ravi  | 90000         |
| Kiran | 75000         |
| Asha  | 65000         |

---
**Query #4**

    
    
    -- compute month-start and sums in a derived table, then left-join to previous month
    SELECT
      m.account_id,
      m.month_start,
      m.monthly_spending,
      p.monthly_spending AS prev_month_spending
    FROM (
      SELECT
        account_id,
        DATE_FORMAT(txn_date, '%Y-%m-01') AS month_start,
        SUM(amount) AS monthly_spending
      FROM transactions
      WHERE txn_type = 'Debit'
      GROUP BY account_id, month_start
    ) m
    LEFT JOIN (
      SELECT
        account_id,
        DATE_FORMAT(txn_date, '%Y-%m-01') AS month_start,
        SUM(amount) AS monthly_spending
      FROM transactions
      WHERE txn_type = 'Debit'
      GROUP BY account_id, month_start
    ) p
      ON m.account_id = p.account_id
      AND p.month_start = DATE_SUB(m.month_start, INTERVAL 1 MONTH)
    ORDER BY m.account_id, m.month_start;

| account_id | month_start | monthly_spending | prev_month_spending |
| ---------- | ----------- | ---------------- | ------------------- |
| 101        | 2023-01-01  | 5000             |                     |
| 102        | 2023-02-01  | 3000             |                     |
| 103        | 2023-02-01  | 15000            |                     |
| 103        | 2023-03-01  | 20000            | 15000               |
| 105        | 2023-04-01  | 25000            |                     |
| 106        | 2023-05-01  | 5000             |                     |

---
**Query #5**

    
    
    SELECT *
    FROM transactions
    WHERE amount > (
        SELECT AVG(amount) FROM transactions
    );

| txn_id | account_id | txn_date   | txn_type | amount |
| ------ | ---------- | ---------- | -------- | ------ |
| 4      | 103        | 2023-02-15 | Debit    | 15000  |
| 5      | 103        | 2023-03-10 | Debit    | 20000  |
| 7      | 105        | 2023-04-01 | Debit    | 25000  |
| 8      | 105        | 2023-04-15 | Credit   | 18000  |

---
**Query #6**

    
    
    SELECT
      customer_id,
      name,
      total_spending,
      @r := @r + 1 AS spending_rank
    FROM (
      SELECT 
        c.customer_id,
        c.name,
        SUM(t.amount) AS total_spending
      FROM customers c
      JOIN accounts a ON c.customer_id = a.customer_id
      JOIN transactions t ON a.account_id = t.account_id
      WHERE t.txn_type = 'Debit'
      GROUP BY c.customer_id, c.name
      ORDER BY SUM(t.amount) DESC
    ) AS cs
    CROSS JOIN (SELECT @r := 0) AS vars;

| customer_id | name  | total_spending | spending_rank |
| ----------- | ----- | -------------- | ------------- |
| 2           | Ravi  | 35000          | 1             |
| 4           | Kiran | 25000          | 2             |
| 1           | Asha  | 8000           | 3             |
| 5           | Divya | 5000           | 4             |

---

[View on DB Fiddle](https://www.db-fiddle.com/f/HxFAK4s7eyaaxm9yVyoVm/0)
